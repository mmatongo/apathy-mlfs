# tc:	 	adjust toolchain.

# 1 >> dump current cross-gcc specs 
SPECFILE=`dirname $(${MLFS_TARGET}-gcc -print-libgcc-file-name)`/specs &&
${MLFS_TARGET}-gcc -dumpspecs > tempspecfile

# 2 >> modify dumped specs file to add the /tools prefix.
sed -i 's/\/lib\/ld-musl-x86_64.so.1/\/tools\/lib\/ld-musl-x86_64.so.1/g' tempspecfile

# i >> check the modified specs file
grep "/tools/lib/ld-musl-x86_64.so.1" tempspecfile --color=auto

# 3 >> install modified specs to the cross toolchain
mv -vf tempspecfile $SPECFILE && unset SPECFILE

# 4
GCC_INCLUDEDIR=$(dirname $(${MLFS_TARGET}-gcc -print-libgcc-file-name))/include &&
find ${GCC_INCLUDEDIR}/* -maxdepth 0 -xtype d -exec rm -rvf '{}' \; &&
rm -vf `grep -l "DO NOT EDIT THIS FILE" ${GCC_INCLUDEDIR}/*` &&
unset GCC_INCLUDEDIR

# 5 >> sanity check
echo 'int main(){}' > dummy.c
${MLFS_TARGET}-gcc -B/tools/lib dummy.c
readelf -l a.out | grep ': /tools'

# i >> output should be:
# [Requesting program interpreter: /tools/lib/ld-musl-x86_64.so.1]

# 6 >> remove the sanity check files.
rm -v a.out dummy.c 
